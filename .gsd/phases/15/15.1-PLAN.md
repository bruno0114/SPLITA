---
phase: 15
plan: 1
wave: 1
---

# Plan 15.1: Smart Routing & Base Responsive Fixes

## Objective
Implement a smart routing logic to distinguish between new and returning users and fix critical mobile layout issues (viewport height and navbar overlapping).

## Context
- `src/App.tsx`: Routing logic.
- `src/features/auth/pages/Onboarding.tsx`: Onboarding flow and "Close" button.
- `src/features/auth/pages/Login.tsx`: Login viewport fixes.
- `src/components/layout/BottomNav.tsx`: Navbar overlay management.

## Tasks

<task type="auto">
  <name>Implement Smart Routing Logic</name>
  <files>
    - src/App.tsx
    - src/features/auth/pages/Onboarding.tsx
    - src/features/auth/pages/Login.tsx
  </files>
  <action>
    1. In `App.tsx`, introduce a check for `localStorage.getItem('has_visited')`.
    2. If no session AND NOT `has_visited`, default redirect to `/onboarding`.
    3. In `Onboarding.tsx`, set `has_visited = 'true'` when the user clicks "Empezar" or "Iniciá sesión".
    4. In `Login.tsx`, ensure navigating to registration still works but doesn't loop.
  </action>
  <verify>Verify that a fresh incognito window opens Onboarding, while a revisit after clicking "Start" opens Login.</verify>
  <done>New users see Onboarding; returning users see Login if not authenticated.</done>
</task>

<task type="auto">
  <name>Responsive Viewport & Navbar Overlap Fixes</name>
  <files>
    - src/features/auth/pages/Login.tsx
    - src/features/auth/pages/Onboarding.tsx
    - src/App.tsx
  </files>
  <action>
    1. Replace `min-h-screen` or `h-screen` with `min-h-[100dvh]` in `Login.tsx` and `Onboarding.tsx` main containers.
    2. Add `pb-32` or similar padding to main mobile containers in `App.tsx` or specifically in pages to prevent BottomNav overlap.
    3. Ensure `Onboarding.tsx` header has the "Close" button removed as requested.
    4. Adjust `Login.tsx` container width and padding for better small screen fit.
  </action>
  <verify>Check Login and Onboarding in mobile viewport; ensure content is fully visible and not cut off by the navbar.</verify>
  <done>Layout is scrollable and fits correctly in mobile viewports using dvh.</done>
</task>

## Success Criteria
- [ ] Fresh visitors land on Onboarding.
- [ ] Returning visitors land on Login.
- [ ] Login/Onboarding screens use dynamic viewport height (dvh).
- [ ] BottomNav does not cut off important page/modal content.
