# Architecture

> Auto-generated by /map on 2026-01-19

## Overview

SPLITA is a financial management PWA for personal finance tracking and group expense splitting. Built with React 19, TypeScript, and Supabase backend.

```
┌─────────────────────────────────────────────────────┐
│                    App.tsx (Router)                 │
│           Theme, Currency, Navigation State         │
├─────────────────────────────────────────────────────┤
│  AuthProvider     │  Layout Components              │
│  (Supabase Auth)  │  Sidebar, Header, BottomNav     │
├───────────────────┴─────────────────────────────────┤
│                  Feature Modules                    │
│  ┌─────────┬─────────┬─────────┬─────────┬───────┐ │
│  │  auth   │dashboard│ groups  │expenses │settings│ │
│  │ context │ pages   │ hooks   │ hooks   │ hooks  │ │
│  │ hooks   │ hooks   │ pages   │ pages   │ pages  │ │
│  │ pages   │         │         │         │        │ │
│  └─────────┴─────────┴─────────┴─────────┴───────┘ │
├─────────────────────────────────────────────────────┤
│                  Data Layer                         │
│    supabase.ts  │  Custom Hooks  │  Types           │
└─────────────────────────────────────────────────────┘
                          │
                          ▼
              ┌───────────────────────┐
              │   Supabase Backend    │
              │  PostgreSQL + Auth    │
              │       + RLS           │
              └───────────────────────┘
```

## Feature Modules

### auth
- **Purpose:** Authentication, onboarding, login
- **Location:** `src/features/auth/`
- **Components:**
  - `AuthContext.tsx` - Global auth state provider
  - `useAuth.ts` - Auth actions hook
  - `Login.tsx` - Email/OAuth login page
  - `Onboarding.tsx` - 6-step new user flow
  - `ProtectedRoute.tsx` - Route guard

### dashboard
- **Purpose:** Personal finance views
- **Location:** `src/features/dashboard/`
- **Components:**
  - `PersonalFinance.tsx` - Balance, transactions list
  - `EconomicHealth.tsx` - Financial health score
  - `usePersonalTransactions.ts` - CRUD for personal_transactions
  - `useEconomicHealth.ts` - Score calculation

### groups
- **Purpose:** Group expense management
- **Location:** `src/features/groups/`
- **Components:**
  - `Groups.tsx` - Group list with create modal
  - `GroupDetails.tsx` - Single group view
  - `useGroups.ts` - CRUD for groups/group_members

### expenses
- **Purpose:** Shared expense tracking + AI import
- **Location:** `src/features/expenses/`
- **Components:**
  - `ImportExpenses.tsx` - Gemini AI receipt scanner
  - `useTransactions.ts` - Group transactions CRUD

### settings
- **Purpose:** User profile and preferences
- **Location:** `src/features/settings/`
- **Components:**
  - `Settings.tsx` - Profile edit, currency settings
  - `useProfile.ts` - Profile CRUD

## Data Flow

1. **Authentication:** `AuthProvider` checks Supabase session → sets global user state
2. **Protected Routes:** `ProtectedRoute` checks auth → redirects if not authenticated
3. **Feature Hooks:** Each feature has hooks that fetch from Supabase with RLS
4. **Real-time Updates:** Hooks use `useEffect` to fetch on mount/user change

## Integration Points

| Service | Type | Purpose |
|---------|------|---------|
| Supabase Auth | OAuth + Email | User authentication |
| Supabase Database | PostgreSQL | Data persistence |
| Google Gemini | AI API | Receipt/invoice scanning |
| DolarAPI | REST API | Real-time exchange rates |

## Database Tables

| Table | Purpose | RLS |
|-------|---------|-----|
| profiles | User profiles | ✓ |
| groups | Expense groups | ✓ |
| group_members | Group membership | ✓ |
| transactions | Group transactions | ✓ |
| transaction_splits | Who owes what | ✓ |
| personal_transactions | Personal finance | ✓ |
| user_settings | Preferences | ✓ |

## Technical Debt

- [ ] Group invitations (pending members) not implemented
- [ ] Avatar upload with WebP compression not implemented
- [ ] Real-time activity feed placeholder
- [ ] Group balance calculation returns 0 (needs pivot query)
- [ ] No automated tests

## Conventions

- **Naming:** PascalCase components, camelCase hooks/functions
- **Structure:** Feature-based with pages/hooks/components subdirs
- **State:** React hooks + Supabase real-time
- **Styling:** Tailwind CSS + custom glassmorphism classes
